name: Merge camperbot PR's

on:
  pull_request:
    types: [opened, synchronize]

env:
  GITHUB_TOKEN: ${{ secrets.CROWDIN_CAMPERBOT_PAT }}

jobs:
  auto-merge:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Merge camperbot PR
        if: github.actor == 'camperbot'
        uses: actions/github-script@v6
        with:
          script: |
            const { owner, repo, pull_number } = context.issue;
            const octokit = github.getOctokit(process.env.GITHUB_TOKEN);
            const pr = await octokit.pulls.get({
              owner,
              repo,
              pull_number
            });

            if (pr.data.user.login === 'moT01') {
              await octokit.pulls.merge({
                owner,
                repo,
                pull_number
              });
            } else {
              console.log('PR author is not camperbot');
            }
